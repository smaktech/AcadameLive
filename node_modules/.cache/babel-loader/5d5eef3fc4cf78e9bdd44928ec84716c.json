{"ast":null,"code":"import _regeneratorRuntime from\"D:/Projects/Cdss apps/Final version/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Projects/Cdss apps/Final version/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Projects/Cdss apps/Final version/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"D:/Projects/Cdss apps/Final version/admin/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{createContext,useEffect,useReducer}from'react';// utils\nimport axios from'../utils/axios';import{isValidToken,setSession}from'../utils/jwt';import{decryptJWT,RestLogin}from'src/api/Auth/Auth';// ----------------------------------------------------------------------\nimport{jsx as _jsx}from\"react/jsx-runtime\";var initialState={isAuthenticated:false,isInitialized:false,user:null};var handlers={INITIALIZE:function INITIALIZE(state,action){var _action$payload=action.payload,isAuthenticated=_action$payload.isAuthenticated,user=_action$payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:isAuthenticated,isInitialized:true,user:user});},LOGIN:function LOGIN(state,action){var user=action.payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:true,user:user});},LOGOUT:function LOGOUT(state){return _objectSpread(_objectSpread({},state),{},{isAuthenticated:false,user:null});},REGISTER:function REGISTER(state,action){var user=action.payload.user;return _objectSpread(_objectSpread({},state),{},{isAuthenticated:true,user:user});}};var reducer=function reducer(state,action){return handlers[action.type]?handlers[action.type](state,action):state;};var AuthContext=/*#__PURE__*/createContext(_objectSpread(_objectSpread({},initialState),{},{method:'jwt',login:function login(){return Promise.resolve();},logout:function logout(){return Promise.resolve();},register:function register(){return Promise.resolve();}}));function AuthProvider(_ref){var children=_ref.children;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];useEffect(function(){var initialize=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accessToken,response,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;accessToken=window.localStorage.getItem('accessToken');if(!(accessToken&&isValidToken(accessToken))){_context.next=11;break;}setSession(accessToken);_context.next=6;return decryptJWT(accessToken);case 6:response=_context.sent;user=response.data.user;dispatch({type:'INITIALIZE',payload:{isAuthenticated:true,user:user}});_context.next=12;break;case 11:dispatch({type:'INITIALIZE',payload:{isAuthenticated:false,user:null}});case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.error(_context.t0);dispatch({type:'INITIALIZE',payload:{isAuthenticated:false,user:null}});case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function initialize(){return _ref2.apply(this,arguments);};}();initialize();},[]);var login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email,password){var response,accessToken,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return RestLogin({email:email,password:password});case 2:response=_context2.sent;accessToken=response.accessToken,user=response.user;setSession(accessToken);dispatch({type:'LOGIN',payload:{user:user}});case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function login(_x,_x2){return _ref3.apply(this,arguments);};}();var register=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(email,password,firstName,lastName){var response,_response$data,accessToken,user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.post('/api/account/register',{email:email,password:password,firstName:firstName,lastName:lastName});case 2:response=_context3.sent;_response$data=response.data,accessToken=_response$data.accessToken,user=_response$data.user;window.localStorage.setItem('accessToken',accessToken);dispatch({type:'REGISTER',payload:{user:user}});case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function register(_x3,_x4,_x5,_x6){return _ref4.apply(this,arguments);};}();var logout=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setSession(null);dispatch({type:'LOGOUT'});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function logout(){return _ref5.apply(this,arguments);};}();var resetPassword=function resetPassword(){};var updateProfile=function updateProfile(user){dispatch({type:'LOGIN',payload:{user:user}});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:_objectSpread(_objectSpread({},state),{},{method:'jwt',login:login,logout:logout,register:register,resetPassword:resetPassword,updateProfile:updateProfile}),children:children});}export{AuthContext,AuthProvider};","map":{"version":3,"sources":["D:/Projects/Cdss apps/Final version/admin/src/contexts/JWTContext.js"],"names":["createContext","useEffect","useReducer","axios","isValidToken","setSession","decryptJWT","RestLogin","initialState","isAuthenticated","isInitialized","user","handlers","INITIALIZE","state","action","payload","LOGIN","LOGOUT","REGISTER","reducer","type","AuthContext","method","login","Promise","resolve","logout","register","AuthProvider","children","dispatch","initialize","accessToken","window","localStorage","getItem","response","data","console","error","email","password","firstName","lastName","post","setItem","resetPassword","updateProfile"],"mappings":"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","sourcesContent":["import { createContext, useEffect, useReducer } from 'react';\nimport PropTypes from 'prop-types';\n// utils\nimport axios from '../utils/axios';\nimport { isValidToken, setSession } from '../utils/jwt';\nimport { decryptJWT, RestLogin } from 'src/api/Auth/Auth';\n\n// ----------------------------------------------------------------------\n\nconst initialState = {\n  isAuthenticated: false,\n  isInitialized: false,\n  user: null\n};\n\nconst handlers = {\n  INITIALIZE: (state, action) => {\n    const { isAuthenticated, user } = action.payload;\n    return {\n      ...state,\n      isAuthenticated,\n      isInitialized: true,\n      user\n    };\n  },\n  LOGIN: (state, action) => {\n    const { user } = action.payload;\n    return {\n      ...state,\n      isAuthenticated: true,\n      user\n    };\n  },\n  LOGOUT: (state) => ({\n    ...state,\n    isAuthenticated: false,\n    user: null\n  }),\n  REGISTER: (state, action) => {\n    const { user } = action.payload;\n\n    return {\n      ...state,\n      isAuthenticated: true,\n      user\n    };\n  }\n};\n\nconst reducer = (state, action) => (handlers[action.type] ? handlers[action.type](state, action) : state);\n\nconst AuthContext = createContext({\n  ...initialState,\n  method: 'jwt',\n  login: () => Promise.resolve(),\n  logout: () => Promise.resolve(),\n  register: () => Promise.resolve()\n});\n\nAuthProvider.propTypes = {\n  children: PropTypes.node\n};\n\nfunction AuthProvider({ children }) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  useEffect(() => {\n    const initialize = async () => {\n      try {\n        const accessToken = window.localStorage.getItem('accessToken');\n\n        if (accessToken && isValidToken(accessToken)) {\n          setSession(accessToken);\n\n          const response = await decryptJWT(accessToken);\n          const { user } = response.data;\n\n          dispatch({\n            type: 'INITIALIZE',\n            payload: {\n              isAuthenticated: true,\n              user\n            }\n          });\n        } else {\n          dispatch({\n            type: 'INITIALIZE',\n            payload: {\n              isAuthenticated: false,\n              user: null\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: 'INITIALIZE',\n          payload: {\n            isAuthenticated: false,\n            user: null\n          }\n        });\n      }\n    };\n\n    initialize();\n  }, []);\n\n  const login = async (email, password) => {\n    // const response = await axios.post('/api/account/login', {\n    //   email,\n    //   password\n    // });\n    const response = await RestLogin({ email, password });\n    const { accessToken, user } = response;\n\n    setSession(accessToken);\n    dispatch({\n      type: 'LOGIN',\n      payload: {\n        user\n      }\n    });\n  };\n\n  const register = async (email, password, firstName, lastName) => {\n    const response = await axios.post('/api/account/register', {\n      email,\n      password,\n      firstName,\n      lastName\n    });\n    const { accessToken, user } = response.data;\n\n    window.localStorage.setItem('accessToken', accessToken);\n    dispatch({\n      type: 'REGISTER',\n      payload: {\n        user\n      }\n    });\n  };\n\n  const logout = async () => {\n    setSession(null);\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  const resetPassword = () => { };\n\n  const updateProfile = (user) => {\n    dispatch({\n      type: 'LOGIN',\n      payload: {\n        user\n      }\n    });\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        ...state,\n        method: 'jwt',\n        login,\n        logout,\n        register,\n        resetPassword,\n        updateProfile\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport { AuthContext, AuthProvider };\n"]},"metadata":{},"sourceType":"module"}